(n=>{n.YTFeedAnalytics=class{constructor(e={}){this.config={enabled:!1!==e.enabled,provider:e.provider||"ga4",measurementId:e.measurementId||null,customEvents:!1!==e.customEvents,debug:e.debug||!1,sessionId:this.generateSessionId(),userId:e.userId||this.generateUserId(),...e},this.eventQueue=[],this.isInitialized=!1,this.startTime=Date.now(),this.config.enabled&&this.init()}init(){this.detectEnvironment(),this.initializeProvider(),this.isInitialized=!0,this.flushEventQueue(),this.config.debug&&console.log("YT Feed Analytics initialized:",this.config)}detectEnvironment(){this.environment={userAgent:navigator.userAgent,screenWidth:n.screen.width,screenHeight:n.screen.height,viewportWidth:n.innerWidth,viewportHeight:n.innerHeight,deviceType:this.getDeviceType(),isMobile:n.innerWidth<=767,isTablet:767<n.innerWidth&&n.innerWidth<=1023,isDesktop:1023<n.innerWidth,referrer:document.referrer,url:n.location.href,timestamp:(new Date).toISOString()}}getDeviceType(){var e=n.innerWidth;return e<=767?"mobile":e<=1023?"tablet":"desktop"}initializeProvider(){"ga4"===this.config.provider&&this.config.measurementId&&this.initializeGA4()}initializeGA4(){var e;n.gtag||((e=document.createElement("script")).async=!0,e.src="https://www.googletagmanager.com/gtag/js?id="+this.config.measurementId,document.head.appendChild(e),n.dataLayer=n.dataLayer||[],n.gtag=function(){n.dataLayer.push(arguments)},n.gtag("js",new Date),n.gtag("config",this.config.measurementId,{debug_mode:this.config.debug,send_page_view:!1})),this.config.debug&&console.log("Google Analytics 4 initialized with ID:",this.config.measurementId)}track(e,t={}){this.config.enabled&&(t=this.enrichEventData(e,t),this.isInitialized?this.sendEvent(e,t):this.eventQueue.push({eventName:e,eventData:t}))}enrichEventData(e,t){var i={event_category:"yt_feed_widget",event_label:t.video_title||t.layout_type||"unknown",session_id:this.config.sessionId,user_id:this.config.userId,widget_version:"1.2.0",device_type:this.environment.deviceType,viewport_width:this.environment.viewportWidth,viewport_height:this.environment.viewportHeight,timestamp:Date.now(),session_duration:Date.now()-this.startTime,page_url:n.location.href,...t};switch(e){case"video_play":i.value=1;break;case"subscribe_click":i.value=5;break;case"load_more_click":i.value=2}return i}sendEvent(e,t){"ga4"===this.config.provider&&n.gtag&&n.gtag("event",e,t),this.config.customEvents&&this.sendCustomEvent(e,t),this.config.debug&&console.log("Analytics Event:",e,t)}sendCustomEvent(e,t){var i=new CustomEvent("yt_feed_analytics",{detail:{eventName:e,eventData:t,timestamp:Date.now()}});document.dispatchEvent(i),n.ytFeedAnalyticsCallback&&"function"==typeof n.ytFeedAnalyticsCallback&&n.ytFeedAnalyticsCallback(e,t)}flushEventQueue(){for(;0<this.eventQueue.length;){var{eventName:e,eventData:t}=this.eventQueue.shift();this.sendEvent(e,t)}}trackVideoPlay(e,t,i){this.track("video_play",{video_id:e.id,video_title:e.title,video_duration:e.duration,video_views:e.viewCount,video_channel:e.channelTitle,video_position:t,layout_type:i,play_method:"thumbnail_click"})}trackVideoClose(e,t,i){this.track("video_close",{video_id:e.id,video_title:e.title,watch_time_seconds:Math.round(t/1e3),layout_type:i,engagement_rate:1e4<t?"high":3e3<t?"medium":"low"})}trackCarouselNavigation(e,t,i){this.track("carousel_navigate",{navigation_direction:e,current_position:t,total_videos:i,layout_type:"carousel"})}trackLoadMore(e,t,i){this.track("load_more_click",{videos_shown_before:e,total_videos:t,layout_type:i,engagement_depth:e/t})}trackSubscribeClick(e,t){this.track("subscribe_click",{channel_id:e.channelId,channel_title:e.channelTitle,layout_type:t,subscriber_intent:!0})}trackWidgetLoad(e,t){this.track("widget_load",{layout_type:e.layout||"carousel",video_count:t,auto_play:e.autoPlay||!1,grid_columns:e.gridColumns||null,load_time_seconds:(Date.now()-this.startTime)/1e3})}trackError(e,t,i={}){this.track("widget_error",{error_type:e,error_message:t,...i})}generateSessionId(){return"yt_session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}generateUserId(){let t=null;try{(t=localStorage.getItem("yt_feed_user_id"))||(t="yt_user_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),localStorage.setItem("yt_feed_user_id",t))}catch(e){t="yt_user_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}return t}getAnalyticsSummary(){return{config:this.config,environment:this.environment,sessionDuration:Date.now()-this.startTime,isInitialized:this.isInitialized,eventQueueLength:this.eventQueue.length}}disable(){this.config.enabled=!1,this.config.debug&&console.log("YT Feed Analytics disabled")}enable(){this.config.enabled=!0,this.isInitialized||this.init(),this.config.debug&&console.log("YT Feed Analytics enabled")}}})(window);